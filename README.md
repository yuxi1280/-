# åŸºäºHC32F460çš„å……ç”µæ¡©æ§åˆ¶ç³»ç»Ÿ

## ğŸ“– é¡¹ç›®ä»‹ç»

è¿™æ˜¯ä¸€ä¸ªä¸“ä¸ºæ–°èƒ½æºå……ç”µæ¡©è®¾è®¡çš„å®Œæ•´æ§åˆ¶ç³»ç»Ÿï¼ŒåŸºäºHC32F460(32ä½ARM Cortex-M4)å¾®æ§åˆ¶å™¨å¼€å‘ã€‚è¯¥é¡¹ç›®æä¾›äº†ä¸€å¥—å…¨é¢çš„ç¡¬ä»¶é©±åŠ¨å’Œåº”ç”¨å±‚ä»£ç ï¼Œæ”¯æŒå¯„å­˜å™¨çº§åˆ«çš„ç›´æ¥ç¼–è¾‘ï¼Œå…¼å®¹VSCodeå¼€å‘ç¯å¢ƒï¼Œå¯è¿›è¡Œå¿«é€Ÿç¨‹åºç¼–è¯‘å’Œåœ¨çº¿çƒ§å½•ã€‚

ç³»ç»Ÿé‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œå„åŠŸèƒ½ç‹¬ç«‹å¯é…ç½®ï¼Œé€‚ç”¨äºå¤šç§å……ç”µæ¡©ç¡¬ä»¶å¹³å°ï¼Œå…·æœ‰è¾ƒé«˜çš„å¯ç§»æ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

- ğŸ”§ **å®Œæ•´çš„HC32F460é©±åŠ¨åº“** - æä¾›æ‰€æœ‰å¤–è®¾çš„åº•å±‚é©±åŠ¨æ”¯æŒ
- ğŸ“ **å¯„å­˜å™¨çº§ç¼–è¾‘** - æ”¯æŒç›´æ¥ä¿®æ”¹æ§åˆ¶å¯„å­˜å™¨ï¼Œæ–¹ä¾¿è°ƒè¯•å’Œä¼˜åŒ–
- ğŸ’» **VSCodeåŸç”Ÿæ”¯æŒ** - å®Œå…¨å…¼å®¹VSCodeå¼€å‘ç¯å¢ƒï¼Œæ— éœ€é‡å‹IDE
- ğŸ“¥ **åœ¨çº¿ç¨‹åºä¸‹è½½** - æ”¯æŒé€šè¿‡ä¸²å£/USBçš„å¿«é€Ÿç¨‹åºçƒ§å½•
- ğŸ”Œ **æ¨¡å—åŒ–æ¶æ„** - å„åŠŸèƒ½æ¨¡å—ç‹¬ç«‹è®¾è®¡ï¼Œä¾¿äºé›†æˆå’Œç»´æŠ¤
- ğŸš€ **é«˜æ€§èƒ½** - å……åˆ†åˆ©ç”¨Cortex-M4é«˜æ€§èƒ½ç‰¹æ€§ï¼Œæ”¯æŒå®æ—¶å¤„ç†

## ğŸ“‹ é¡¹ç›®ç»“æ„è¯¦è§£

```
.
â”œâ”€â”€ src/                          # æºä»£ç æ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ main.c                    # ä¸»ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ uart.c                    # UARTä¸²å£é©±åŠ¨
â”‚   â”œâ”€â”€ rs485.c                   # RS485é€šä¿¡é©±åŠ¨
â”‚   â”œâ”€â”€ spi.c                     # SPIæ¥å£é©±åŠ¨
â”‚   â”œâ”€â”€ crc16_modbus.c            # Modbus CRCæ ¡éªŒç®—æ³•
â”‚   â”œâ”€â”€ encoder.c                 # ç¼–ç å™¨é©±åŠ¨
â”‚   â”œâ”€â”€ pid_pos.c                 # ä½ç½®PIDæ§åˆ¶
â”‚   â”œâ”€â”€ pid_speed.c               # é€Ÿåº¦PIDæ§åˆ¶
â”‚   â”œâ”€â”€ moto.c                    # ç”µæœºæ§åˆ¶
â”‚   â”œâ”€â”€ flash.c                   # Flashå­˜å‚¨ç®¡ç†
â”‚   â”œâ”€â”€ at24c02.c                 # 24C02 EEPROMé©±åŠ¨
â”‚   â”œâ”€â”€ ws2812.c                  # WS2812 RGBç¯æ§åˆ¶
â”‚   â”œâ”€â”€ soft_timer.c              # è½¯å®šæ—¶å™¨
â”‚   â”œâ”€â”€ ir_comm.c                 # çº¢å¤–é€šä¿¡
â”‚   â”œâ”€â”€ relay_ctrl.c              # ç»§ç”µå™¨æ§åˆ¶
â”‚   â”œâ”€â”€ msg.c                     # æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿ
â”‚   â”œâ”€â”€ doraemon_pack.c           # æ•°æ®æ‰“åŒ…åè®®
â”‚   â”œâ”€â”€ io.c                      # GPIOè¾“å…¥è¾“å‡º
â”‚   â””â”€â”€ mix_std_lib.c             # æ··åˆæ ‡å‡†åº“å‡½æ•°
â”‚
â”œâ”€â”€ inc/                          # å¤´æ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ uart.h, rs485.h, ...      # å¯¹åº”çš„å¤´æ–‡ä»¶å®šä¹‰
â”‚
â”œâ”€â”€ sys/                          # ç³»ç»Ÿæ–‡ä»¶
â”‚   â”œâ”€â”€ startup_hc32f460.s        # ARMæ±‡ç¼–å¯åŠ¨ä»£ç 
â”‚   â””â”€â”€ cmsis/                    # CMSISæ ‡å‡†åº“
â”‚       â””â”€â”€ core/                 # ARM Cortex-M4æ ¸å¿ƒå¤´æ–‡ä»¶
â”‚
â”œâ”€â”€ build/                        # ç¼–è¯‘é…ç½®
â”‚   â””â”€â”€ makefile                  # GNU Makeç¼–è¯‘è„šæœ¬
â”‚
â”œâ”€â”€ obj/                          # ç¼–è¯‘ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶
â”‚   â””â”€â”€ EPC_DCBM.dis              # åæ±‡ç¼–æ–‡ä»¶
â”‚
â”œâ”€â”€ LICENSE                       # è®¸å¯è¯æ–‡ä»¶
â””â”€â”€ README.md                     # æœ¬æ–‡ä»¶
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

| å·¥å…· | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| VSCode | æœ€æ–°ç‰ˆ | ä»£ç ç¼–è¾‘å™¨ |
| GCC ARM | arm-none-eabi-gcc | ARMäº¤å‰ç¼–è¯‘å·¥å…·é“¾ |
| Make | 3.81+ | ç¼–è¯‘æ„å»ºå·¥å…· |
| OpenOCD | 0.10+ | çƒ§å½•å’Œè°ƒè¯•å·¥å…· |

### å®‰è£…æ­¥éª¤

#### 1. é…ç½®ç¼–è¯‘å·¥å…·é“¾

**Windowsç³»ç»Ÿ:**
```bash
# ä¸‹è½½å¹¶å®‰è£… ARM GCC
# https://developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain/gnu-rm

# ä¸‹è½½å¹¶å®‰è£… Make
# http://gnuwin32.sourceforge.net/packages/make.htm

# éªŒè¯å®‰è£…
arm-none-eabi-gcc --version
make --version
```

**Linux/Macç³»ç»Ÿ:**
```bash
# Ubuntu/Debian
sudo apt-get install build-essential gcc-arm-none-eabi

# macOS (ä½¿ç”¨ Homebrew)
brew install arm-none-eabi-gcc
```

#### 2. VSCodeæ‰©å±•å®‰è£…

æ¨èå®‰è£…ä»¥ä¸‹VSCodeæ‰©å±•ä»¥æå‡å¼€å‘ä½“éªŒï¼š
- **Cortex-Debug** - ARMè°ƒè¯•æ”¯æŒ
- **C/C++ IntelliSense** - ä»£ç æ™ºèƒ½è¡¥å…¨
- **Makefile Tools** - Makefileæ”¯æŒ
- **Serial Monitor** - ä¸²å£ç›‘è§†å™¨

#### 3. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/yourusername/hc32f460-charger.git
cd hc32f460-charger
```

### ç¼–è¯‘ä¸çƒ§å½•

#### ç¼–è¯‘é¡¹ç›®

```bash
cd build
make clean          # æ¸…é™¤ä¹‹å‰çš„ç¼–è¯‘äº§ç‰©
make all            # ç¼–è¯‘å…¨éƒ¨
# ç”Ÿæˆçš„binæ–‡ä»¶åœ¨ obj/ ç›®å½•ä¸‹
```

#### çƒ§å½•ç¨‹åº

**ä½¿ç”¨OpenOCD:**
```bash
openocd -f interface/stlink-v2.cfg -f target/stm32f4x.cfg
# åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­ä½¿ç”¨GDBçƒ§å½•
arm-none-eabi-gdb obj/EPC_DCBM.elf
```

**ä½¿ç”¨ä¸²å£çƒ§å½•å·¥å…·:**
```bash
# ä½¿ç”¨ä¸“ç”¨çƒ§å½•è½¯ä»¶ï¼Œé€‰æ‹©COMå£å’Œæ³¢ç‰¹ç‡(é€šå¸¸ä¸º115200)
# å°†ç¨‹åºçƒ§å½•åˆ°HC32F460
```

## ğŸ”Œ ä¸»è¦åŠŸèƒ½æ¨¡å—è¯¦è§£

### é€šä¿¡æ¨¡å—

| æ¨¡å— | æ–‡ä»¶ | åŠŸèƒ½è¯´æ˜ |
|------|------|--------|
| **UART** | uart.c/h | å¼‚æ­¥ä¸²è¡Œé€šä¿¡ï¼Œæ³¢ç‰¹ç‡å¯é…ï¼Œæ”¯æŒä¸­æ–­æ¨¡å¼ |
| **RS485** | rs485.c/h | æ¨¡æ€»çº¿åè®®å®ç°ï¼Œæœ€å¤šæ”¯æŒ32ä¸ªèŠ‚ç‚¹ |
| **IR** | ir_comm.c/h | çº¢å¤–é¥æ§é€šä¿¡ï¼Œç¼–ç è§£ç  |

### æ§åˆ¶æ¨¡å—

| æ¨¡å— | æ–‡ä»¶ | åŠŸèƒ½è¯´æ˜ |
|------|------|--------|
| **PIDä½ç½®æ§åˆ¶** | pid_pos.c/h | ä½ç½®é—­ç¯æ§åˆ¶ç®—æ³•ï¼Œå‚æ•°å¯åŠ¨æ€è°ƒæ•´ |
| **PIDé€Ÿåº¦æ§åˆ¶** | pid_speed.c/h | é€Ÿåº¦é—­ç¯æ§åˆ¶ï¼Œé‡‡æ ·é¢‘ç‡1kHz |
| **ç”µæœºé©±åŠ¨** | moto.c/h | PWMè°ƒé€Ÿï¼Œæ–¹å‘æ§åˆ¶ï¼Œè¿‡æµä¿æŠ¤ |
| **ç»§ç”µå™¨æ§åˆ¶** | relay_ctrl.c/h | å¤šè·¯ç»§ç”µå™¨æ§åˆ¶ï¼Œå¸¦çŠ¶æ€åé¦ˆ |

### å­˜å‚¨æ¨¡å—

| æ¨¡å— | æ–‡ä»¶ | åŠŸèƒ½è¯´æ˜ |
|------|------|--------|
| **Flash** | flash.c/h | å†…éƒ¨Flashè¯»å†™ï¼Œæ”¯æŒæ‰‡åŒºæ“¦é™¤ |
| **EEPROM** | at24c02.c/h | 24C02å¤–éƒ¨å­˜å‚¨ï¼ŒI2Cæ¥å£ |

### å…¶ä»–åŠŸèƒ½

| æ¨¡å— | æ–‡ä»¶ | åŠŸèƒ½è¯´æ˜ |
|------|------|--------|
| **ç¼–ç å™¨** | encoder.c/h | æ—‹è½¬ç¼–ç å™¨è®¡æ•°ï¼Œæ”¯æŒæ­£åå‘ |
| **RGBç¯** | ws2812.c/h | WS2812Bå½©è‰²ç¯ç æ§åˆ¶ï¼Œæ”¯æŒæµæ°´/æ¸å˜æ•ˆæœ |
| **è½¯å®šæ—¶å™¨** | soft_timer.c/h | éå®æ—¶å®šæ—¶å™¨ï¼Œç”¨äºå®šæ—¶ä»»åŠ¡ |
| **CRCæ ¡éªŒ** | crc16_modbus.c/h | Modbusæ ‡å‡†CRC16æ ¡éªŒ |
| **æ¶ˆæ¯é˜Ÿåˆ—** | msg.c/h | ä»»åŠ¡é—´æ¶ˆæ¯ä¼ é€’æœºåˆ¶ |
| **æ•°æ®æ‰“åŒ…** | doraemon_pack.c/h | è‡ªå®šä¹‰é€šä¿¡åè®®å®ç° |
| **GPIO** | io.c/h | é€šç”¨æ•°å­—I/Oæ“ä½œ |

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: åŸºç¡€ä¸²å£é€šä¿¡

```c
#include "uart.h"

int main(void) {
    uart_init(UART1, 115200);  // åˆå§‹åŒ–UART1ï¼Œæ³¢ç‰¹ç‡115200
    
    uart_send_string(UART1, "Hello World!\n");
    
    while(1) {
        if(uart_available(UART1)) {
            char c = uart_recv_char(UART1);
            uart_send_char(UART1, c);  // å›æ˜¾å­—ç¬¦
        }
    }
}
```

### ç¤ºä¾‹2: PIDé€Ÿåº¦æ§åˆ¶

```c
#include "pid_speed.h"
#include "encoder.h"

int main(void) {
    encoder_init();
    pid_speed_init(1.0, 0.5, 0.1);  // P, I, Då‚æ•°
    
    uint16_t target_speed = 1000;  // ç›®æ ‡é€Ÿåº¦
    
    while(1) {
        uint16_t current_speed = encoder_get_speed();
        uint16_t pwm_val = pid_speed_calc(target_speed, current_speed);
        set_motor_pwm(pwm_val);
    }
}
```

### ç¤ºä¾‹3: RS485é€šä¿¡

```c
#include "rs485.h"
#include "crc16_modbus.h"

int main(void) {
    rs485_init(115200);
    
    uint8_t tx_buf[256];
    uint8_t rx_buf[256];
    
    // æ„å»ºModbus RTUæŠ¥æ–‡
    tx_buf[0] = 0x01;           // ä»æœºåœ°å€
    tx_buf[1] = 0x03;           // è¯»ä¿æŒå¯„å­˜å™¨åŠŸèƒ½ç 
    tx_buf[2] = 0x00;           // èµ·å§‹åœ°å€é«˜å­—èŠ‚
    tx_buf[3] = 0x00;           // èµ·å§‹åœ°å€ä½å­—èŠ‚
    tx_buf[4] = 0x00;           // å¯„å­˜å™¨ä¸ªæ•°é«˜å­—èŠ‚
    tx_buf[5] = 0x02;           // å¯„å­˜å™¨ä¸ªæ•°ä½å­—èŠ‚
    
    // è®¡ç®—CRCæ ¡éªŒç 
    uint16_t crc = crc16_modbus(tx_buf, 6);
    tx_buf[6] = crc & 0xFF;     // CRCä½å­—èŠ‚
    tx_buf[7] = (crc >> 8) & 0xFF;  // CRCé«˜å­—èŠ‚
    
    rs485_send(tx_buf, 8);
    rs485_recv(rx_buf, 256);
    
    return 0;
}
```

## ğŸ”§ é…ç½®è¯´æ˜

ä¸»è¦é…ç½®æ–‡ä»¶ä½äº `inc/` ç›®å½•ä¸‹ï¼Œå¸¸è§é…ç½®é¡¹ï¼š

```c
// uart.h - ä¸²å£é…ç½®
#define UART1_BAUDRATE      115200
#define UART1_BUFFER_SIZE   256

// pid_speed.h - PIDå‚æ•°
#define PID_KP              1.0
#define PID_KI              0.5
#define PID_KD              0.1

// moto.h - ç”µæœºé…ç½®
#define MOTOR_PWM_FREQ      20000    // PWMé¢‘ç‡ 20kHz
#define MOTOR_PWM_MAX       1000     // PWMæœ€å¤§å€¼
```

## ğŸ› è°ƒè¯•æ–¹æ³•

### ä½¿ç”¨OpenOCD + GDBè°ƒè¯•

```bash
# å¯åŠ¨OpenOCDå®ˆæŠ¤è¿›ç¨‹
openocd -f interface/stlink-v2.cfg -f target/stm32f4x.cfg &

# ä½¿ç”¨GDBè¿æ¥
arm-none-eabi-gdb obj/EPC_DCBM.elf
(gdb) target remote localhost:3333
(gdb) load                    # åŠ è½½ç¨‹åº
(gdb) break main              # åœ¨mainå¤„è®¾ç½®æ–­ç‚¹
(gdb) continue                # ç»§ç»­è¿è¡Œ
(gdb) step                    # å•æ­¥æ‰§è¡Œ
```

### ä½¿ç”¨ä¸²å£ç›‘è§†å™¨æŸ¥çœ‹æ—¥å¿—

åœ¨VSCodeä¸­ä½¿ç”¨Serial Monitoræ‰©å±•ï¼Œé…ç½®COMå£å’Œæ³¢ç‰¹ç‡ï¼Œå®æ—¶æŸ¥çœ‹ä¸²å£è¾“å‡ºã€‚

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| ä¸»é¢‘ | 200 MHz |
| å†…å­˜ | 256 KB SRAM |
| Flash | 512 KB |
| GPIO | 100+ |
| UART | 4ä¸ª |
| SPI | 3ä¸ª |
| I2C | 2ä¸ª |

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ **MITè®¸å¯è¯** å¼€æºå‘å¸ƒï¼Œè¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ‘¥ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

### å¦‚ä½•è´¡çŒ®

1. Forkæœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯Pull Request

### ä»£ç è§„èŒƒ

- ä½¿ç”¨GNUé£æ ¼ç¼©è¿›(4ç©ºæ ¼)
- å‡½æ•°å’Œå˜é‡é‡‡ç”¨è›‡å½¢å‘½åæ³•: `function_name`, `variable_name`
- ä¸ºå¤æ‚é€»è¾‘æ·»åŠ æ³¨é‡Š
- æ–°åŠŸèƒ½éœ€é™„å¸¦å•å…ƒæµ‹è¯•

## ğŸ“ è”ç³»æ–¹å¼

- ğŸ“§ Email: your-email@example.com
- ğŸ’¬ è®¨è®ºåŒº: GitHub Discussions
- ğŸ› BugæŠ¥å‘Š: GitHub Issues

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…å’Œä½¿ç”¨è€…çš„æ”¯æŒï¼

---

**æœ€åæ›´æ–°**: 2026å¹´1æœˆ22æ—¥
